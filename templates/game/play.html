
<title>Fight</title>

{% block content %}

{% for player in current_player %}
    <a href="{% url 'items:shop' player.pk %}"><h5>Shop</h5></a>
    <br>
    <a href="{% url 'items:potions-available' player.pk %}"><h5>Use potion</h5></a>
    <br><br>
    <h5>{{ player.name }}</h5>
    <h5 id="player-lvl"> Level: {{ player.level }}</h5>
    <h5 id="player-exp">Experience: {{ player.experience }}</h5>
    <h5 id="player-health">Health: {{ player.current_health }}</h5>
    <h5>Mana: {{ player.current_mana }}</h5>
    <br>
    <form id="hit" method="POST">
        {% csrf_token %}
        <button id="btn">Attack with {{ player.weapon_equipped.name }}</button>
    </form>
        <br>
        <button>Attack with available spells</button>
        <br><br>
{% endfor %}

{% for monster in current_monster %}
    <h5 id="monster-type">{{ monster.name }}</h5>
    <h5 id="monster-health">Health: {{ monster.health }}</h5>
    <h5>Immune: {{ monster.immune }}</h5>
{% endfor %}

    <br><br>
    <a href="{% url 'game:home' %}">Home</a>

{% endblock %}


{% block javascript %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken')

    $(document).ready(function() {
            $('#btn').click(function(e) {
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        csrfmiddlewaretoken: csrftoken,
                     },
                    data: $('#hit').serialize(),
                    success: function(response) {
                        if(response.status == 0){
                            alert('You have died')
                            window.location = response.url;
                        }
                        else{
                            $(' #monster-health').html('Health: ' + response.monster_health);
                            $(' #player-health').html('Health: ' + response.player_health);
                            $(' #player-exp').html('Experience: ' + response.player_exp);
                            $(' #player-lvl').html('Level: ' + response.player_lvl);
                            $(' #monster-type').html(response.monster_type);
                            if(response.monster_health <= 0) {
                                alert('You have killed the monster');
                                $(' #monster-health').html('Health: ' + 0);
                            }
                        }
                    }
                });
            });
        });

    </script>

{% endblock javascript%}


